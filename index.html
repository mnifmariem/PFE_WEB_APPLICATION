<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>IoT Predictive Maintenance Analysis Platform</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    :root {
      --primary-color: #0d6efd;
      --success-bg: #d4edda;
      --success-text: #155724;
      --error-bg: #f8d7da;
      --error-text: #721c24;
      --sidebar-width: 250px;
    }

    body {
      background-color: #ffffff;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      height: 100vh;
    }

    #sidebar {
      width: var(--sidebar-width);
      background-color: #f8f9fa;
      padding: 20px;
      height: 100%;
      position: fixed;
      top: 0;
      left: 0;
      overflow-y: auto;
      box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s;
    }

    #sidebar.collapsed {
      transform: translateX(-100%);
    }

    #sidebar .nav-link {
      color: #333;
      padding: 10px 15px;
      text-decoration: none;
      display: block;
      border-radius: 5px;
      margin-bottom: 5px;
    }

    #sidebar .nav-link:hover, #sidebar .nav-link.active {
      background-color: #e9ecef;
      color: var(--primary-color);
    }
    
    #sidebar-toggle {
      position: absolute;
      top: 10px;
      right: 10px;
      background-color: #f8f9fa;
      border: 1px solid #f8f9fa;
      border-radius: 5px;
      padding: 5px 10px;
      cursor: pointer;
      font-size: 1.5rem;
      z-index: 1001;
      display: block !important;
      width: 40px;
      height: 40px;
      text-align: center;
      transition: transform 0.3s, left 0.3s, right 0.3s;
    }

    #sidebar.collapsed #sidebar-toggle {
      display: none;
    }

    #toggle-container {
      position: fixed;
      top: 10px;
      left: 10px;
      z-index: 1000;
      display: none;
    }

    #sidebar.collapsed ~ #content #toggle-container {
      display: block;
    }

    #toggle-container button {
      background-color: #ffffff;
      border: 1px solid #dee2e6;
      color: #333;
      border-radius: 5px;
      padding: 5px 10px;
      cursor: pointer;
      font-size: 1.5rem;
      width: 40px;
      height: 40px;
      text-align: center;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    #content {
      margin-left: var(--sidebar-width);
      padding: 20px;
      flex-grow: 1;
      overflow-y: auto;
      transition: margin-left 0.3s;
      position: relative;
    }

    #content.shifted {
      margin-left: 0;
    }

    .container-flex {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .scenario {
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      flex: 1 1 45%;
      min-width: 300px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      transition: transform 0.2s;
    }

    .scenario h3 {
      font-size: 1.28rem; /* Smaller font size (default h3 is ~1.5rem in Bootstrap) */
      margin-top: 10px; /* Space before the title */
      margin-bottom: 20px; /* Space after the title */
    }

    .scenario:hover {
      transform: translateY(-5px);
    }

    .collapsible-header {
      cursor: pointer;
      padding: 15px;
      background-color: #e9ecef;
      border-radius: 5px;
      margin-bottom: 10px;
      transition: background-color 0.2s;
      display: flex;
      align-items: center;
      gap: 10px;
      height: 60px;
      text-decoration: none;
      font-size: 1.1rem;
    }

    .collapsible-header:hover {
      background-color: #dee2e6;
    }

    .collapsible-content {
      display: none;
      padding: 15px;
      border: 1px solid #dee2e6;
      border-radius: 5px;
      background-color: #f9f9f9;
    }

    .realtime-toggle, .upload-title {
      color: var(--primary-color);
      font-weight: 500;
      transition: color 0.3s;
      margin: 0;
    }

    .realtime-toggle:hover, .upload-title:hover {
      color: #0056b3;
    }

    .data-preview-title {
      margin-top: 15px;
      font-weight: 600;
      font-size: 1.1rem;
      color: #333;
    }

    .output-box pre {
      white-space: pre-wrap;
      word-break: break-word;
      max-height: 250px;
      overflow-y: auto;
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      padding: 15px;
      border-radius: 6px;
      font-size: 0.9rem;
    }

    table {
      width: 100%;
      margin-top: 15px;
      font-family: monospace;
      border-collapse: collapse;
    }

    th, td {
      padding: 8px;
      border: 1px solid #dee2e6;
      text-align: center;
    }

    th {
      background: #e9ecef;
      font-weight: 600;
    }

    .upload-area {
      border: 2px dashed #ccc;
      padding: 25px;
      text-align: center;
      background-color: #fff;
      border-radius: 8px;
      transition: all 0.3s ease;
      display: none;
    }

    .upload-area.dragover {
      background-color: #e9ecef;
      border-color: var(--primary-color);
    }

    .file-info {
      margin-top: 10px;
      color: #555;
      font-size: 0.9rem;
    }

    .success-message {
      background-color: var(--success-bg);
      color: var(--success-text);
      padding: 10px;
      border-radius: 5px;
      margin-top: 10px;
      display: none;
      font-size: 0.9rem;
    }

    .error-message {
      background-color: var(--error-bg);
      color: var(--error-text);
      padding: 10px;
      border-radius: 5px;
      margin-top: 10px;
      display: none;
      font-size: 0.9rem;
    }

    .total-samples {
      margin-top: 10px;
      font-size: 0.9rem;
      color: #555;
    }

    h1.text-center {
      margin-top: 70px; /* Space before the main title */
      margin-bottom: 60px; /* Space after the main title */
    }

    h2.text-center {
      margin-top: 40px; /* Space before the subtitle */
      margin-bottom: 40px; /* Increased space after the subtitle */
    }
    .data-preview-title {
    margin-top: 15px;
    margin-bottom: 15px; /* Adds 15px of space below the title */
    font-weight: 600;
    font-size: 1.1rem;
    color: #333;
}
    @media (max-width: 768px) {
      #sidebar {
        transform: translateX(-100%);
      }
      #content {
        margin-left: 0;
      }
      .scenario {
        flex: 1 1 100%;
      }
    }
  </style>
</head>
<body>
  <div id="sidebar">
    <button id="sidebar-toggle" onclick="toggleSidebar()">
      <i class="bi bi-list"></i>
    </button>
    <h3 class="text-center mb-4">Menu</h3>
    <a href="index.html" class="nav-link active">Data Upload & Processing</a>
    <a href="algorithms.html" class="nav-link">FFT vs Goertzel Analysis</a>
    <a href="energy.html" class="nav-link">Energy Consumption</a>
    <a href="latency.html" class="nav-link">Latency</a>
    <a href="scenarios.html" class="nav-link">Scenario Comparison</a>
    <a href="report.html" class="nav-link">Comprehensive Report</a>
  </div>
  <div id="content">
    <div id="toggle-container">
      <button id="sidebar-toggle-collapsed" onclick="toggleSidebar()">
        <i class="bi bi-arrow-left" style="color: #333;"></i>
      </button>
    </div>
    <h1 class="text-center mb-4"><i class="bi bi-gear" style="color: #000000;"></i> IoT Predictive Maintenance Analysis Platform</h1>
    <h2 class="text-center mb-4"><i class="bi bi-upload" style="color: #ffc107;"></i> Data Handling and Processing</h2>

    <div class="container-flex">
      <!-- Scenario 1 -->
      <div class="scenario">
        <h3><i class="bi bi-database" style="color: #28a745;"></i> Scenario 1: Raw Data</h3>
        <div class="collapsible-header" onclick="toggleSection('realtime1', 'toggle1')">
          <i class="bi bi-clock-history" style="color: #17a2b8;"></i>
          <span id="toggle1" class="realtime-toggle">Real-time Data Acquisition</span>
        </div>
        <div id="realtime1" class="collapsible-content">
          <select id="com1" class="form-select mb-2"><option value="">COM Port</option><option>COM6</option><option>COM7</option><option>COM8</option><option>COM9</option></select>
          <select id="baud1" class="form-select mb-2"><option value="">Baud Rate</option><option>9600</option><option>115200</option></select>
          <button id="connect1" class="btn btn-primary me-2 mb-2">Connect</button>
          <button id="disc1" class="btn btn-secondary mb-2" disabled>Disconnect</button>
          <div id="error1" class="error-message"></div>
        </div>
        <div class="upload-section">
          <div class="collapsible-header" onclick="toggleUploadSection('upload1', 'uploadTitle1')">
            <i class="bi bi-cloud-upload" style="color: #ffc107;"></i>
            <span id="uploadTitle1" class="upload-title">Data Upload & Processing</span>
          </div>
          <div id="upload1" class="upload-area" ondragover="event.preventDefault();" ondrop="handleDrop(event, '1');">
            <i class="bi bi-cloud-upload" style="color: #ffc107; font-size: 2rem;"></i> Drag and drop file here<br>
            Limit 200MB per file - CSV, TSV, TXT
            <button class="btn btn-outline-warning mt-2">Browse files</button>
            <div id="fileInfo1" class="file-info"></div>
            <div id="success1" class="success-message"></div>
            <div id="error1" class="error-message"></div>
          </div>
        </div>
        <div id="title1" class="data-preview-title" style="display:none;"><i class="bi bi-table" style="color: #0d6efd;"></i> Data Preview </div>

        <div id="out1" class="output-box"></div>
        <div id="totalSamples1" class="total-samples" style="display:none;">Total Samples: 0</div>
      </div>

      <!-- Scenario 2 -->
      <div class="scenario">
        <h3><i class="bi bi-bar-chart" style="color: #dc3545;"></i> Scenario 2: Goertzel Algorithm results</h3>
        <div class="collapsible-header" onclick="toggleSection('realtime2', 'toggle2')">
          <i class="bi bi-clock-history" style="color: #17a2b8;"></i>
          <span id="toggle2" class="realtime-toggle">Real-time Data Acquisition</span>
        </div>
        <div id="realtime2" class="collapsible-content">
          <select id="com2" class="form-select mb-2"><option value="">COM Port</option><option>COM6</option><option>COM7</option><option>COM8</option><option>COM9</option></select>
          <select id="baud2" class="form-select mb-2"><option value="">Baud Rate</option><option>9600</option><option>115200</option></select>
          <button id="connect2" class="btn btn-primary me-2 mb-2">Connect</button>
          <button id="disc2" class="btn btn-secondary mb-2" disabled>Disconnect</button>
          <div id="error2" class="error-message"></div>
        </div>
        <div class="upload-section">
          <div class="collapsible-header" onclick="toggleUploadSection('upload2', 'uploadTitle2')">
            <i class="bi bi-cloud-upload" style="color: #ffc107;"></i>
            <span id="uploadTitle2" class="upload-title">Data Upload & Processing</span>
          </div>
          <div id="upload2" class="upload-area" ondragover="event.preventDefault();" ondrop="handleDrop(event, '2');">
            <i class="bi bi-cloud-upload" style="color: #ffc107; font-size: 2rem;"></i> Drag and drop file here<br>
            Limit 200MB per file - CSV, TSV, TXT
            <button class="btn btn-outline-warning mt-2">Browse files</button>
            <div id="fileInfo2" class="file-info"></div>
            <div id="success2" class="success-message"></div>
            <div id="error2" class="error-message"></div>
          </div>
        </div>
        <div id="title2" class="data-preview-title" style="display:none;"><i class="bi bi-table" style="color: #0d6efd;"></i> Data Preview</div>
        <div id="out2" class="output-box"></div>
      </div>
    </div>

    <script>
      // Utility: toggle display of sections
      function toggleSection(contentId, titleId) {
        const content = document.getElementById(contentId);
        content.style.display = content.style.display === 'none' ? 'block' : 'none';
      }

      // Utility: toggle display of upload section
      function toggleUploadSection(contentId, titleId) {
        const content = document.getElementById(contentId);
        content.style.display = content.style.display === 'none' ? 'block' : 'none';
      }

      // Setup toggles
      ['1', '2'].forEach(pref => {
        document.getElementById(`toggle${pref}`).addEventListener('click', () => {
          const ctr = document.getElementById(`realtime${pref}`);
          ctr.style.display = ctr.style.display === 'none' ? 'block' : 'none';
          if (ctr.style.display === 'none') {
            clearSection(pref);
          }
        });
      });

      function clearSection(pref) {
        document.getElementById(`out${pref}`).innerHTML = '';
        document.getElementById(`title${pref}`).style.display = 'none';
        document.getElementById(`fileInfo${pref}`).textContent = '';
        document.getElementById(`success${pref}`).style.display = 'none';
        document.getElementById(`error${pref}`).style.display = 'none';
        document.getElementById(`totalSamples${pref}`).style.display = 'none';
        document.getElementById(`totalSamples${pref}`).textContent = 'Total Samples: 0';
      }

      // Setup each scenario: prefix, isGoertzel
      function setupScenario(pref, isGoertzel) {
        const com = document.getElementById(`com${pref}`),
              baud = document.getElementById(`baud${pref}`),
              conn = document.getElementById(`connect${pref}`),
              disc = document.getElementById(`disc${pref}`),
              out = document.getElementById(`out${pref}`),
              title = document.getElementById(`title${pref}`),
              upload = document.getElementById(`upload${pref}`),
              fileInfo = document.getElementById(`fileInfo${pref}`),
              success = document.getElementById(`success${pref}`),
              error = document.getElementById(`error${pref}`),
              totalSamples = document.getElementById(`totalSamples${pref}`);
        let ws;

        conn.addEventListener('click', () => {
          if (!com.value || !baud.value) {
            alert('Please select both COM Port and Baud Rate.');
            return;
          }
          console.log(`[${pref}] Attempting WebSocket connection to ws://localhost:3009`);
          ws = new WebSocket(`ws://localhost:3009`);
          ws.onopen = () => {
            console.log(`[${pref}] WebSocket connected, sending connect command`);
            ws.send(JSON.stringify({ command: 'connect', comPort: com.value, baudRate: Number(baud.value) }));
            conn.disabled = true;
            disc.disabled = false;
          };
          ws.onmessage = (e) => {
            console.log(`[${pref}] WebSocket message received:`, e.data);
            const msg = JSON.parse(e.data);
            console.log(`[${pref}] Parsed WebSocket message:`, msg);
            console.log(`[${pref}] Data keys:`, msg.data ? msg.data.map(r => Object.keys(r)) : 'No data');
            if ((isGoertzel && msg.type === 'goertzel') || (!isGoertzel && msg.type === 'raw')) {
              display(msg.data, pref, isGoertzel);
              localStorage.setItem(`scenario${pref}Data`, JSON.stringify(msg.data));
              ws.close();
            } else if (msg.error) {
              error.textContent = msg.error;
              error.style.display = 'block';
            }
          };
          ws.onclose = () => {
            console.log(`[${pref}] WebSocket closed`);
            conn.disabled = false;
            disc.disabled = true;
          };
          ws.onerror = (err) => {
            console.error(`[${pref}] WebSocket error:`, err);
            error.textContent = 'WebSocket error: Connection failed';
            error.style.display = 'block';
          };
        });

        disc.addEventListener('click', () => {
          if (ws && ws.readyState === WebSocket.OPEN) ws.close();
          clearSection(pref);
        });

        function display(data, pref, isGoertzel) {
          console.log(`[${pref}] Displaying data:`, data);
          title.style.display = 'block';
          if (isGoertzel) {
            const rows = data.map(r => {
              console.log(`[${pref}] Row data structure:`, Object.keys(r), 'Values:', r);
              return `<tr><td>${r.freq || 'N/A'}</td><td>${r.c !== undefined ? r.c : 'N/A'}</td><td>${r.q0 || 'N/A'}</td><td>${r.q1 || 'N/A'}</td><td>${r.q2 || 'N/A'}</td></tr>`;
            }).join('');
            out.innerHTML = `<table><thead><tr><th>Freq (Hz)</th><th>Coeff</th><th>Q0</th><th>Q1</th><th>Q2</th></tr></thead><tbody>${rows}</tbody></table>`;
          } else {
            let rawData = typeof data === 'string' ? data : JSON.stringify(data);
            out.innerHTML = `<pre>${rawData}</pre>`;
            if (pref === '1') {
              const lines = rawData.trim().split(/[\r\n]+/).filter(line => line.trim().length > 0);
              let totalValues = 0;
              if (lines.length === 1) {
                totalValues = lines[0].split(',').filter(val => val.trim().length > 0).length;
              } else {
                totalValues = lines.length;
              }
              console.log(`[${pref}] Processed lines/values from WebSocket:`, lines, 'Total Values:', totalValues);
              totalSamples.textContent = `Total Samples: ${totalValues}`;
              totalSamples.style.display = 'block';
            }
          }
        }

        upload.addEventListener('dragover', (e) => {
          e.preventDefault();
          upload.classList.add('dragover');
          console.log(`[${pref}] Dragover detected for upload${pref}`);
        });

        upload.addEventListener('dragleave', () => {
          upload.classList.remove('dragover');
          console.log(`[${pref}] Dragleave detected for upload${pref}`);
        });

        upload.addEventListener('drop', (e) => {
          e.preventDefault();
          upload.classList.remove('dragover');
          const file = e.dataTransfer.files[0];
          console.log(`[${pref}] Dropped file for upload${pref}:`, file ? { name: file.name, type: file.type, size: file.size } : 'No file');
          if (file) {
            processFile(file, pref, isGoertzel);
          } else {
            error.textContent = 'No file dropped';
            error.style.display = 'block';
            console.error(`[${pref}] No file dropped`);
          }
        });

        upload.querySelector('button').addEventListener('click', () => {
          console.log(`[${pref}] Browse files clicked for upload${pref}`);
          const input = document.createElement('input');
          input.type = 'file';
          input.accept = '.csv,.tsv,.txt';
          input.onchange = (e) => {
            const file = e.target.files[0];
            console.log(`[${pref}] File selected for upload${pref}:`, file ? { name: file.name, type: file.type, size: file.size } : 'No file');
            if (file) {
              processFile(file, pref, isGoertzel);
            } else {
              error.textContent = 'No file selected';
              error.style.display = 'block';
              console.error(`[${pref}] No file selected`);
            }
          };
          input.click();
        });

        function processFile(file, pref, isGoertzel) {
          console.log(`[${pref}] Starting file processing:`, { name: file.name, type: file.type, size: file.size });
          if (!file) {
            error.textContent = 'No file provided';
            error.style.display = 'block';
            fileInfo.textContent = '';
            success.style.display = 'none';
            console.error(`[${pref}] No file provided`);
            return;
          }

          const extension = file.name.split('.').pop().toLowerCase();
          if (!['csv', 'tsv', 'txt'].includes(extension) || file.size > 200 * 1024 * 1024) {
            error.textContent = `Invalid file type (must be .csv, .tsv, or .txt) or size exceeds 200MB`;
            error.style.display = 'block';
            fileInfo.textContent = '';
            success.style.display = 'none';
            console.error(`[${pref}] Invalid file:`, { name: file.name, type: file.type, size: file.size, extension });
            return;
          }

          fileInfo.textContent = `${file.name} (${(file.size / 1024).toFixed(1)}KB)`;
          console.log(`[${pref}] File accepted, reading:`, file.name);

          const fr = new FileReader();
          fr.onload = () => {
            console.log(`[${pref}] File read successfully, length: ${fr.result.length} characters`);
            title.style.display = 'block';
            const lines = fr.result.trim().split(/[\r\n]+/).filter(line => line.trim().length > 0);
            console.log(`[${pref}] Parsed ${lines.length} lines from file:`, lines.slice(0, 3)); // Log first 3 lines for debugging

            if (!isGoertzel) {
              out.innerHTML = `<pre>${fr.result}</pre>`;
              if (pref === '1') {
                let totalValues = 0;
                if (lines.length === 1) {
                  totalValues = lines[0].split(',').filter(val => val.trim().length > 0).length;
                } else {
                  totalValues = lines.length;
                }
                console.log(`[${pref}] Processed lines/values from file:`, lines, 'Total Values:', totalValues);
                totalSamples.textContent = `Total Samples: ${totalValues}`;
                totalSamples.style.display = 'block';
                localStorage.setItem(`scenario${pref}Data`, JSON.stringify(lines.map(line => line.trim())));
              }
              success.textContent = `Data loaded successfully! Shape: (${lines.length}, 1)`;
              success.style.display = 'block';
              error.style.display = 'none';
              console.log(`[${pref}] Scenario 1 data displayed successfully`);
            } else {
              // Try comma delimiter first (CSV), then tab (TSV)
              const delimiters = [',', '\t'];
              let rows = [];
              let headerFound = false;
              let delimiterUsed = '';
              let idx = -1;

              for (const delimiter of delimiters) {
                idx = lines.findIndex(l => {
                  const cols = l.split(delimiter).map(col => col.trim().toLowerCase());
                  return cols.some(col => col.includes('freq'));
                });
                if (idx >= 0) {
                  const header = lines[idx].split(delimiter).map(col => col.trim().toLowerCase());
                  const hasRequiredColumns = header.some(col => col.includes('freq')) &&
                                            header.some(col => col.includes('coeff')) &&
                                            header.some(col => col.includes('q0')) &&
                                            header.some(col => col.includes('q1')) &&
                                            header.some(col => col.includes('q2'));
                  if (hasRequiredColumns) {
                    headerFound = true;
                    delimiterUsed = delimiter;
                    console.log(`[${pref}] Header found at index ${idx} with delimiter "${delimiter === ',' ? 'comma' : 'tab'}":`, header);
                    break;
                  }
                }
              }

              if (!headerFound) {
                error.textContent = 'Invalid file format: Missing header with Frequency, Coefficient, Q0, Q1, Q2';
                error.style.display = 'block';
                success.style.display = 'none';
                out.innerHTML = `<pre>${fr.result}</pre>`;
                console.error(`[${pref}] No valid header found in file`);
                return;
              }

              for (let i = idx + 1; i < lines.length; i++) {
                const l = lines[i];
                if (l.startsWith('===') || l.toLowerCase().startsWith('sending')) {
                  console.log(`[${pref}] Skipping line:`, l);
                  continue;
                }
                const columns = l.split(delimiterUsed).map(col => col.replace(/^"|"$/g, '').trim());
                if (columns.length >= 5) {
                  const freq = Number(columns[0]);
                  const c = Number(columns[1]);
                  const q0 = Number(columns[2]);
                  const q1 = Number(columns[3]);
                  const q2 = Number(columns[4]);
                  if (!isNaN(freq) && !isNaN(c) && !isNaN(q0) && !isNaN(q1) && !isNaN(q2)) {
                    rows.push({ freq, c, q0, q1, q2 });
                    console.log(`[${pref}] Parsed file row:`, { freq, c, q0, q1, q2 });
                  } else {
                    console.log(`[${pref}] Invalid number in file line:`, l);
                  }
                } else {
                  console.log(`[${pref}] Insufficient columns in file line:`, l);
                }
              }

              if (rows.length === 0) {
                error.textContent = 'No valid data rows found in file';
                error.style.display = 'block';
                success.style.display = 'none';
                out.innerHTML = `<pre>${fr.result}</pre>`;
                console.error(`[${pref}] No valid data rows parsed`);
                return;
              }

              out.innerHTML = `<table><thead><tr><th>Freq (Hz)</th><th>Coeff</th><th>Q0</th><th>Q1</th><th>Q2</th></tr></thead><tbody>${rows.map(r => `<tr><td>${r.freq || 'N/A'}</td><td>${r.c !== undefined ? r.c : 'N/A'}</td><td>${r.q0 || 'N/A'}</td><td>${r.q1 || 'N/A'}</td><td>${r.q2 || 'N/A'}</td></tr>`).join('')}</tbody></table>`;
              localStorage.setItem(`scenario${pref}Data`, JSON.stringify(rows));
              success.textContent = `Data loaded successfully! Shape: (${rows.length}, 5)`;
              success.style.display = 'block';
              error.style.display = 'none';
              console.log(`[${pref}] Scenario 2 data displayed successfully, ${rows.length} rows`);
            }
          };
          fr.onerror = () => {
            error.textContent = 'Error reading file';
            error.style.display = 'block';
            success.style.display = 'none';
            console.error(`[${pref}] FileReader error for file:`, file.name);
          };
          fr.readAsText(file);
          console.log(`[${pref}] Initiated file read for:`, file.name);
        }
      }

      // Initialize scenarios
      setupScenario('1', false);
      setupScenario('2', true);

      // Sidebar toggle function
      function toggleSidebar() {
        const sidebar = document.getElementById('sidebar');
        const content = document.getElementById('content');
        const toggleBtn = document.getElementById('sidebar-toggle');
        const toggleCollapsedBtn = document.getElementById('sidebar-toggle-collapsed');
        console.log('[Sidebar] Toggling sidebar. Current state:', sidebar.classList.contains('collapsed'));
        if (sidebar && content && toggleBtn && toggleCollapsedBtn) {
          const isCollapsed = sidebar.classList.toggle('collapsed');
          content.classList.toggle('shifted');
          if (isCollapsed) {
            toggleBtn.style.display = 'none';
            toggleCollapsedBtn.style.display = 'block';
          } else {
            toggleBtn.style.display = 'block';
            toggleCollapsedBtn.style.display = 'none';
          }
          console.log('[Sidebar] Toggled. New state:', isCollapsed);
        } else {
          console.error('[Sidebar] One or more elements not found:', { sidebar, content, toggleBtn, toggleCollapsedBtn });
        }
      }

      // Initial check
      document.addEventListener('DOMContentLoaded', () => {
        const toggleBtn = document.getElementById('sidebar-toggle');
        const toggleCollapsedBtn = document.getElementById('sidebar-toggle-collapsed');
        if (!toggleBtn || !toggleCollapsedBtn) {
          console.error('[Sidebar] Toggle button(s) not found on page load!');
        } else {
          console.log('[Sidebar] Toggle buttons found on page load');
          toggleBtn.style.display = 'block';
          toggleCollapsedBtn.style.display = 'none';
        }
      });
    </script>
  </div>
</body>
</html>